import collectable.*
import main_character.*
import backpack.*
import extras.*
import mosquito.*
import navigation.*
import randomizer.*
import posiciones.*
import obstacles.*
import wollok.game.*

describe "uso de collectables" {

	method initialize() {
		game.clear()
		mainCharacter.build()
	}

	test "usar el spray, equipar el spray, matar mosquitos" {
		mainCharacter.position(game.at(1, 3))
		mainCharacter.direction(rightDirection)
		mainCharacter.disparar() // main character dispara su spray que ya tiene una carga equipada de 4 disparos
		assert.equals(3, insecticide.shoots()) // deben quedar 3 disparos
		insecticide.recargar() // se recarga spray
		assert.equals(4, insecticide.shoots()) // vuelve a tener 4 disparos
		const mH1 = new MosquitoHard(position = game.at(2, 3)) // se crea un Mosquito
		game.addVisual(mH1)
		mH1.moving()
		mosquitoesManager.mosquitoes().add(mH1)
		backpack.mosquitoes(0) // inicialmente la mochila tiene cero mosquitos muertos para analizar.
		mainCharacter.disparar() // main character dispara en la direccion al mosquito creado que lo tiene al alcance.
		assert.equals(3, insecticide.shoots()) // se descuenta un disparo de su spray
		assert.equals(#{}, mosquitoesManager.mosquitoes()) // el mosquito fue eliminado
		assert.equals(1, backpack.mosquitoes()) // la mochila tiene un mosquito para analizar guardado.
	}

	test "perder una vida y recuperar con el uso de vacuna" {
		const mS1 = mosquitoFactory.create()
		const mH1 = mosquitoHardFactory.create()
		mS1.position(game.at(3, 2)) // se ubica un mosquito soft a un casillero a la derecha del main character
		game.addVisual(mS1)
		mS1.moving()
		mosquitoesManager.mosquitoes().add(mS1)
		mH1.position(game.at(2, 3)) // se ubica un mosquito hard un casillero arriba del main character
		game.addVisual(mH1)
		mH1.moving()
		mosquitoesManager.mosquitoes().add(mH1)
		mainCharacter.goesTo(rightDirection)
		assert.equals([ mainCharacter, mS1 ], game.getObjectsIn(game.at(3, 2)).asList())
	}

//
//	test "usar los espirales y matar mosquitos" {
//	}
//
//	test "recolectar mosquitos, basura, cajas de spirales" {
//	}
}

